# å¼¹å¹•APIç®¡ç†åå°

åŸºäº Nuxt 3 æ„å»ºçš„ç°ä»£åŒ–å¼¹å¹•APIç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šå¹³å°å¼¹å¹•è·å–å’Œç®¡ç†ã€‚

> **âš ï¸ é‡è¦è¯´æ˜**: æœ¬é¡¹ç›®æ‰€æœ‰æ ¸å¿ƒä»£ç å‡æ¥è‡ª [danmu_api](https://github.com/huangxd-/danmu_api)ï¼Œä»…ç”¨äºç»ƒä¹  Nuxt ç›¸å…³æŠ€æœ¯æ ˆã€‚ä¸å»ºè®®ç”¨äºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ã€‚
å¦‚æœ‰ä»»ä½•ä¾µæƒè¡Œä¸ºï¼Œè¯·è”ç³»æœ¬äººåˆ é™¤ã€‚

## ğŸš¨ éƒ¨ç½²å‰å¿…è¯»

å¦‚æœæ‚¨ä»è¦éƒ¨ç½²æ­¤é¡¹ç›®ï¼Œè¯·æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **æ„å»ºæ—¶é—´é•¿** - ç”±äºéœ€è¦å®Œæ•´çš„ Nuxt 3 æ‰“åŒ…æ„å»ºè¿‡ç¨‹ï¼Œéƒ¨ç½²æ—¶é—´ä¼šæ¯”åŸé¡¹ç›®æ›´é•¿
2. **æ€§èƒ½å·®å¼‚** - æ€§èƒ½ä¸ä¼šæ¯”åŸé¡¹ç›®æ›´å¥½ï¼Œä»…é’ˆå¯¹ Nuxt æ¡†æ¶åšäº†ç‰¹æ®Šé€‚é…
3. **ç»´æŠ¤é™åˆ¶** - æ‰€æœ‰æ ¸å¿ƒç‰¹æ€§å‡æ¥è‡ª danmu_apiï¼Œä¸ä¿è¯é•¿æœŸç»´æŠ¤å’Œæ›´æ–°
4. **å­¦ä¹ ç›®çš„** - æœ¬é¡¹ç›®ä¸»è¦ç”¨äºå­¦ä¹  Nuxt 3ã€TypeScript ç­‰ç°ä»£å‰ç«¯æŠ€æœ¯æ ˆ
5. **é¡¹ç›®æ€§è´¨** - ç”±äºåŸé¡¹ç›®æœ¬è´¨æ˜¯ä»¥å³æ—¶è·å–å¼¹å¹•ä¸ºä¸»ï¼Œæ‰€ä»¥æœ¬é¡¹ç›®ä¹Ÿä¸ä¼šå¢åŠ æŒä¹…åŒ–ç›¸å…³çš„ä»»ä½•åŠŸèƒ½ï¼Œä½ åªä¼šæ”¶è·ä¸€ä¸ªç”¨å¤„ä¸å¤§çš„çœ‹æ¿ç•Œé¢ã€‚

**å»ºè®®**: å¦‚éœ€ç¨³å®šçš„ç”Ÿäº§ç¯å¢ƒï¼Œè¯·ç›´æ¥ä½¿ç”¨åŸç‰ˆ [danmu_api](https://github.com/huangxd-/danmu_api)ã€‚

## âœ¨ ç‰¹æ€§

- ğŸš€ **å¼€ç®±å³ç”¨** - æ— éœ€å¤æ‚é…ç½®ï¼Œä¸‹è½½å³å¯è¿è¡Œ
- ğŸ”§ **çµæ´»é…ç½®** - æ”¯æŒç¯å¢ƒå˜é‡å’Œå¯è§†åŒ–é…ç½®
- ğŸŒ **å¤šå¹³å°æ”¯æŒ** - çˆ±å¥‡è‰ºã€è…¾è®¯ã€ä¼˜é…·ã€èŠ’æœTVã€Bç«™ã€äººäººè§†é¢‘ã€éŸ©å°åœˆ
- ğŸ“Š **å®æ—¶ç›‘æ§** - é…ç½®çŠ¶æ€å’Œæ—¥å¿—å¯è§†åŒ–
- ğŸ”’ **ç±»å‹å®‰å…¨** - å®Œæ•´çš„ TypeScript æ”¯æŒ
- ğŸ”„ **å®Œå…¨å…¼å®¹** - ä¸åŸæœ‰å¼¹å¹•APIç³»ç»Ÿ100%å…¼å®¹

[deploy-on-vercel-button-image]: https://vercel.com/button
[deploy-on-vercel-link]: https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2FMangMax%2Fdanmu-admin&env=NUXT_TOKEN&envDescription=For%20safety,%20please%20set%20up%20a%20token&project-name=danmu-admin&repository-name=danmu-admin
[deploy-on-netlify-button-image]: https://www.netlify.com/img/deploy/button.svg
[deploy-on-netlify-link]: https://app.netlify.com/start/deploy?repository=https://github.com/MangMax/danmu-admin
[deploy-on-cloudflare-pages-button-image]: https://deploy.workers.cloudflare.com/button
[deploy-on-cloudflare-pages-link]: https://deploy.workers.cloudflare.com/?url=https://github.com/MangMax/danmu-admin

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å…‹éš†é¡¹ç›®
```bash
git clone https://github.com/MangMax/danmu-admin.git
cd danmu-admin
```

### 2. å®‰è£…ä¾èµ–
```bash
pnpm install
```

### 3. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
```bash
pnpm dev
```

è®¿é—® [http://localhost:3000](http://localhost:3000) å³å¯ä½¿ç”¨ï¼

## âš™ï¸ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€è‡ªå®šä¹‰é…ç½®ï¼Œå¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

### é…ç½®éªŒè¯

è®¿é—® `/api/config` æŸ¥çœ‹å½“å‰é…ç½®çŠ¶æ€ã€‚

## ğŸŒ API ç«¯ç‚¹

### æ ¸å¿ƒAPIï¼ˆä¸åŸç³»ç»Ÿå…¼å®¹ï¼‰

```
GET  /api/v2/search/anime          # æœç´¢åŠ¨æ¼«
GET  /api/v2/search/episodes       # æœç´¢é›†æ•°  
POST /api/v2/match                 # åŒ¹é…åŠ¨æ¼«
GET  /api/v2/bangumi/:animeId      # è·å–ç•ªå‰§è¯¦æƒ…
GET  /api/v2/comment/:commentId    # è·å–å¼¹å¹•
GET  /api/logs                     # è·å–æ—¥å¿—
```

### æ–°å¢API

```
GET  /api/config                   # é…ç½®ä¿¡æ¯
GET  /api/cache/stats              # ç¼“å­˜ç»Ÿè®¡
GET  /api/cache/details            # ç¼“å­˜æ•°æ®è¯¦æƒ…
POST /api/cache/clear              # æ¸…ç©ºç¼“å­˜
GET  /api/test/config-validation   # é…ç½®éªŒè¯æµ‹è¯•
POST /api/test/add-sample-data     # æ·»åŠ æµ‹è¯•æ•°æ®
```

## ğŸŒ è‡ªæ‰˜ç®¡

æœ¬é¡¹ç›®æä¾›äº† Vercelã€Netlifyã€Cloudflare Pagesã€Docker é•œåƒç­‰å¤šç§éƒ¨ç½²æ–¹å¼ï¼Œå¯ä»¥è®©ä½ åœ¨å‡ åˆ†é’Ÿå†…éƒ¨ç½²è‡ªå·±çš„å¼¹å¹•APIç®¡ç†ç³»ç»Ÿã€‚

### `A` ä½¿ç”¨ Vercel, Netlify, Cloudflare Pages ç­‰Serverlesså¹³å°éƒ¨ç½²

#### ä½¿ç”¨ Vercel, Netlify, Cloudflare Pages ç­‰Serverlesså¹³å°éƒ¨ç½²ï¼Œä½ å¯ä»¥è‡ªè¡Œéƒ¨ç½²åˆ°å…¶ä»–å¹³å°ï¼Œç›®å‰ä¸»æµå¹³å°éƒ½å·²æ”¯æŒNuxtä¸€é”®éƒ¨ç½²ï¼Œæ³¨æ„Edgeoneè¿˜ä¸æ”¯æŒå…¨æ ˆNuxtã€‚

å¦‚æœä½ æƒ³è¦åœ¨ Vercel, Netlify, Cloudflare Pages ç­‰Serverlesså¹³å°éƒ¨ç½²è¿™ä¸ªæœåŠ¡ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

- Fork è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å¼ºçƒˆå»ºè®®ä½ å…ˆforkè¿™ä¸ªé¡¹ç›®ï¼Œåœ¨ä½ forkä¹‹åï¼Œåªä¿ç•™ä¸Šæ¸¸åŒæ­¥åŠ¨ä½œï¼Œå¹¶ç¦ç”¨å…¶ä»–åŠ¨ä½œåœ¨ä½ çš„ GitHub ä»“åº“ä¸Šã€‚
- ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹éƒ¨ç½²: ç›´æ¥ä½¿ç”¨ä½ çš„ GitHub è´¦å·ç™»å½•ï¼Œå¹¶åœ¨ç¯å¢ƒå˜é‡ä¸­å¡«å†™ `NUXT_TOKEN` (æ¨è)ã€‚
- éƒ¨ç½²å®Œæˆåï¼Œä½ å¯ä»¥å¼€å§‹ä½¿ç”¨å®ƒã€‚
- ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰åŸŸå (å¯é€‰): Vercel åˆ†é…çš„åŸŸåçš„ DNS åœ¨ä¸€äº›åœ°åŒºä¼šè¢«æ±¡æŸ“; ç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰åŸŸåå¯ä»¥ç›´è¿(æ¨è)ã€‚

<div align="center">

|           åœ¨Verceléƒ¨ç½²            |                    åœ¨Netlifyéƒ¨ç½²                      |                    åœ¨Cloudflare Pageséƒ¨ç½²                      |
| :-------------------------------------: | :---------------------------------------------------------: | :---------------------------------------------------------: |
| [![][deploy-on-vercel-button-image]][deploy-on-vercel-link] | [![][deploy-on-netlify-button-image]][deploy-on-netlify-link] | [![][deploy-on-cloudflare-pages-button-image]][deploy-on-cloudflare-pages-link] |
</div>

### `B` ä½¿ç”¨ Docker éƒ¨ç½²

#### ä½¿ç”¨ Docker éƒ¨ç½²

å¦‚æœä½ æƒ³è¦ä½¿ç”¨ Docker éƒ¨ç½²è¿™ä¸ªæœåŠ¡ï¼Œä½ å¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š

1. æ‹‰å– Docker é•œåƒ
```bash
docker pull mangmax/danmu-admin:latest
```
2. è¿è¡Œ Docker å®¹å™¨
```bash
docker run -d --name danmu-admin -p 3000:3000 mangmax/danmu-admin:latest
```

å¦‚æœéœ€è¦è®¾ç½®ä»¤ç‰Œï¼Œå¯ä»¥åœ¨è¿è¡Œå®¹å™¨æ—¶è®¾ç½® `NUXT_TOKEN` ç¯å¢ƒå˜é‡ã€‚
```bash
docker run -d --name danmu-admin -p 3000:3000 -e NUXT_TOKEN=your_token_here mangmax/danmu-admin:latest
```

3. è®¿é—® [http://localhost:3000](http://localhost:3000) å³å¯ä½¿ç”¨ï¼

<br/>

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

æ‰€æœ‰ç¯å¢ƒå˜é‡å¦‚ä¸‹ï¼Œéƒ½æ˜¯å¯é€‰çš„ï¼š

#### æ ¸å¿ƒæœåŠ¡é…ç½®
| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `NUXT_OTHER_SERVER` | `https://api.danmu.icu` | ç¬¬ä¸‰æ–¹å¼¹å¹•æœåŠ¡å™¨ |
| `NUXT_VOD_SERVER` | `https://www.caiji.cyou` | VODè§†é¢‘èµ„æºæœåŠ¡å™¨ |
| `NUXT_BILIBILI_COOKIE` | `""` | Bç«™Cookieé…ç½® |
| `NUXT_YOUKU_CONCURRENCY` | `8` | ä¼˜é…·å¹¶å‘æ•°é…ç½® (æœ€å¤§16) |

#### æ€§èƒ½ä¸é‡è¯•é…ç½®
| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `NUXT_REQUEST_TIMEOUT` | `30000` | è¯·æ±‚è¶…æ—¶æ—¶é—´ (æ¯«ç§’) |
| `NUXT_MAX_RETRY_COUNT` | `3` | æœ€å¤§é‡è¯•æ¬¡æ•° |

#### è®¤è¯é…ç½® (å¯é€‰)
| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `NUXT_AUTH_USERNAME` | `""` | åŸºç¡€è®¤è¯ç”¨æˆ·å (ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä¸å¯ç”¨) |
| `NUXT_AUTH_PASSWORD` | `""` | åŸºç¡€è®¤è¯å¯†ç  |
| `NUXT_TOKEN` | `""` | APIè®¿é—®ä»¤ç‰Œ (ç©ºå­—ç¬¦ä¸²è¡¨ç¤ºä¸å¯ç”¨è®¤è¯) |

#### å®¢æˆ·ç«¯é…ç½®
| å˜é‡å | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `NUXT_PUBLIC_MAX_LOGS` | `500` | æœ€å¤§æ—¥å¿—æ¡æ•° |
| `NUXT_PUBLIC_MAX_ANIMES` | `100` | æœ€å¤§åŠ¨æ¼«ç¼“å­˜æ•° |

### æœ¬åœ°å¼€å‘

```bash
# å®‰è£…ä¾èµ–
pnpm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
pnpm dev

# æ„å»ºåº”ç”¨
pnpm build

# é¢„è§ˆæ„å»ºç»“æœ
pnpm preview
```

## ğŸ¤ æ„Ÿè°¢

æ„Ÿè°¢ [danmu_api](https://github.com/huangxd-/danmu_api) å¼€æºï¼

## æŠ€æœ¯æ ˆ

å¦‚æœä½ å¯¹æœ¬é¡¹ç›®æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹ä»¥ä¸‹æŠ€æœ¯æ ˆï¼š
- Nuxt 3
- TypeScript
- Vite
- Vue
- Unocss
- Shadcn Nuxt
- VueUse
- ES Toolkit
- Crypto JS
- Crypto TS
- Iconv Lite
- nuxt-auth-utils

## ğŸ“„ è®¸å¯è¯

MIT License
